name: Quarterback Gold Loader

on:
  workflow_dispatch: # Allows manual trigger via GitHub UI

jobs:
  load-data:
    name: Load GeoJSON to Supabase
    runs-on: ubuntu-latest
    timeout-minutes: 60 # Prevents it from running forever if stuck

    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Dependencies
        run: npm install @supabase/supabase-js @aws-sdk/client-s3 dotenv typescript tsx

      - name: Run Quarterback Script
        run: npx tsx scripts/quarterback-loader.ts
        env:
          # We map these to GitHub Secrets (See Step 3 below)
          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_REGION: 'us-east-2'
          AWS_BUCKET_NAME: 'flyr-pro-addresses-2025'
